<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asksibot - Pictogram Search Assistant</title>
    <style>
        /* General styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            text-align: center;
        }

        /* Header styles */
        header {
            background-color: #d3d3d3;
            width: 100%;
            padding: 20px 40px;
            box-sizing: border-box;
        }

        header img {
            width: 70px;
            height: auto;
            margin-bottom: 10px;
        }

        header h1 {
            margin: 0;
            font-size: 2em;
        }

        .subtext {
            font-size: 0.9em;
            margin-top: 5px;
        }

        nav {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        nav a {
            margin: 5px 10px;
            color: black;
            text-decoration: none;
            font-size: 1em;
        }

        /* Content styles */
        .content {
            max-width: 800px;
            width: 100%;
            margin: 20px auto;
            padding: 0 20px;
            box-sizing: border-box;
            text-align: left;
        }

        .content h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            position: relative; /* To position the button */
        }

        /* "How to Use" Button Styles */
        #openInstructionsBtn {
            position: absolute;
            right: 0;
            top: 0;
            padding: 5px 10px;
            background-color: #fdb201;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9em;
        }

        #openInstructionsBtn:hover {
            background-color: #1d1e20;
            color: #fff;
        }

        /* Form styles */
        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-sizing: border-box;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        .instruction {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 5px;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        /* Pre-defined options styles */
        .options-section {
            margin-top: 10px;
        }

        .options-section h4 {
            margin-bottom: 5px;
            font-size: 1em;
        }

        .options-list {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .options-list button {
            margin: 5px;
            padding: 5px 10px;
            font-size: 0.9em;
            background-color: #e7e7e7;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            flex: 1 1 calc(33.333% - 10px); /* Three buttons per row */
            box-sizing: border-box;
        }

        .options-list button:hover {
            background-color: #ccc;
        }

        /* Adjust button sizing for smaller screens */
        @media (max-width: 600px) {
            .options-list button {
                flex: 1 1 calc(50% - 10px); /* Two buttons per row */
            }
        }

        /* Button styles */
        button[type="submit"], .results button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #fdb201;
            color: #000;
            border-radius: 30px;
            border: 2px solid #000;
            font-size: 1em;
            cursor: pointer;
            transition: 0.3s;
        }

        button[type="submit"]:hover, .results button:hover {
            background-color: #1d1e20;
            color: #fff;
        }

        /* Results section */
        #results {
            display: none;
            margin-top: 30px;
            background-color: #e7f3fe;
            padding: 20px;
            box-sizing: border-box;
            border-left: 6px solid #2196F3;
            border-radius: 8px;
        }

        #results h2 {
            color: #2196F3;
        }

        #results ol {
            margin-left: 20px;
        }

        .attribution {
            margin-top: 20px;
            font-size: 0.8em;
            color: #555;
            text-align: center;
        }

        .attribution a {
            color: #555;
            text-decoration: underline;
        }

        /* Pictogram styles */
        .pictogram-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .pictogram-item {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 8px;
            background-color: #fff;
            width: 150px;
            text-align: center;
        }

        .pictogram-item img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .download-button {
            margin-top: 5px;
            padding: 5px 10px;
            background-color: #fdb201;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9em;
        }

        .download-button:hover {
            background-color: #1d1e20;
            color: #fff;
        }

        .error-message {
            color: red;
            text-align: center;
            margin-top: 20px;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 600px) {
            header h1 {
                font-size: 1.5em;
            }

            .subtext {
                font-size: 0.8em;
                line-height: 1.4em;
            }

            nav a {
                font-size: 0.9em;
                margin: 5px 8px;
            }

            .content h2 {
                font-size: 1.4em;
            }

            label {
                font-size: 0.9em;
            }

            button {
                font-size: 0.9em;
            }
        }

        /* Modal Styles */
        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 5% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px; /* Could be more or less, depending on screen size */
            border-radius: 8px;
            position: relative;
            text-align: left;
        }

        /* Close Button */
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 10px;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Read Aloud Button */
        .read-aloud-button {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #fdb201;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            font-size: 0.9em;
        }

        .read-aloud-button:hover, .read-aloud-button:focus {
            background-color: #1d1e20;
            color: #fff;
            outline: none;
        }

    </style>
    <!-- Include Axios from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Asksibot - Pictogram Search Assistant",
      "description": "A tool to help occupational therapy professionals search and utilize pictographic symbols.",
      "url": "https://yourwebsite.com",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "All",
      "browserRequirements": "Requires JavaScript"
    }
    </script>
    <!-- Google Analytics (Replace 'YOUR_TRACKING_ID' with actual ID) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_TRACKING_ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'YOUR_TRACKING_ID');
    </script>
</head>
<body>

<header>
    <img src="media/asksiboticon.png" alt="Asksibot Logo">
    <h1>Asksibot - The Occupational Therapy Hub</h1>
    <p class="subtext">Developed on OpenAI by Christopher Horne, OTR/L</p>
    <nav aria-label="Main Navigation">
        <a href="index.html">Home</a>
        <a href="/surveys/survey_selection.html">Surveys</a>
        <a href="/timeline/timelineupto80.html">Timeline</a>
        <a href="/shop/index.html">Shop</a>
        <a href="/contact.html">Contact</a>
    </nav>
</header>

<div class="content">
    <h2>Pictogram Search Assistant
        <button id="openInstructionsBtn" aria-label="How to Use the Pictogram Search Assistant">How to Use</button>
    </h2>
    <form id="pictogramForm">
        <label for="topic">Topic or Subject:</label>
        <p class="instruction">Use your own term or select a topic from below.</p>
        <input type="text" id="topic" name="topic" placeholder="Enter a topic or select one" required>
        <div class="options-section">
            <h4>Select a Topic:</h4>
            <div class="options-list" id="topicOptions"></div>
        </div>
        <label for="keywords">Specific Keywords or Concepts:</label>
        <p class="instruction">Enter your own keywords or select from the options below.</p>
        <textarea id="keywords" name="keywords" placeholder="Enter keywords separated by commas" required></textarea>
        <div class="options-section">
            <h4>Select Keywords:</h4>
            <div class="options-list" id="keywordOptions"></div>
        </div>
        <button type="submit">Generate Search Terms</button>
    </form>
    <div id="results">
        <h2>Your Search Terms</h2>
        <ul id="searchTermsList"></ul>
        <h3>Pictograms:</h3>
        <div id="pictogramResults" class="pictogram-container"></div>
        <div id="error" class="error-message"></div>
    </div>
</div>

<footer>
    <p class="attribution">
        The pictographic symbols used are the property of the Government of Arag√≥n and have been created by Sergio Palao for ARASAAC (<a href="http://www.arasaac.org" target="_blank" rel="noopener">http://www.arasaac.org</a>), distributed under the Creative Commons License BY-NC-SA.
    </p>
</footer>

<!-- Modal Structure -->
<div id="instructionsModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="instructionsTitle" aria-modal="true">
    <div class="modal-content">
        <span class="close-button" aria-label="Close Instructions">&times;</span>
        <h3 id="instructionsTitle">How to Use the Pictogram Search Assistant</h3>
        <p>
            Welcome to the Asksibot Pictogram Search Assistant! This tool is designed to help find and utilize pictographic symbols from ARASAAC's extensive library.
        </p>
        <p>
            <strong>Steps to Use the Assistant:</strong>
        </p>
        <ol>
            <li>
                <strong>Enter a Topic or Subject:</strong> You can type your own term into the "Topic or Subject" field or select a predefined topic by clicking on one of the buttons below.
            </li>
            <li>
                <strong>Select Specific Keywords:</strong> In the "Specific Keywords or Concepts" section, you can enter your own keywords separated by commas or choose from the provided keywords by clicking the corresponding buttons.
            </li>
            <li>
                <strong>Generate Search Terms:</strong> After selecting your topic and keywords, click the "Generate Search Terms" button. The assistant will compile your inputs into unique search terms.
            </li>
            <li>
                <strong>View Pictograms:</strong> The assistant will display relevant pictograms based on your search terms. You can view, download, or use these pictograms as needed.
            </li>
        </ol>
        <p>
            <strong>What Can Pictograms Be Used For?</strong>
        </p>
        <p>
            Pictograms are versatile tools used to enhance communication, especially for individuals with speech or language difficulties. They can be utilized in various settings, including:
        </p>
        <ul>
            <li>Developing communication boards or systems.</li>
            <li>Creating visual schedules and routines.</li>
            <li>Enhancing instructional materials and learning aids.</li>
            <li>Facilitating social interactions and emotional expression.</li>
            <li>Supporting daily living activities and independence.</li>
        </ul>
        <button class="read-aloud-button" id="readAloudBtn" aria-label="Read Instructions Aloud">Read Instructions Aloud</button>
    </div>
</div>

<!-- JavaScript for Functionality -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Define the 18 topics and their 30 keywords each
        const topics = {
            "Daily Routine": [
                "Wake up", "Brush teeth", "Wash face", "Take a shower", "Get dressed",
                "Eat breakfast", "Pack lunch", "Go to school/work", "Study", "Attend class",
                "Playtime", "Lunch break", "Homework", "Snack time", "Exercise",
                "Read a book", "Watch TV", "Dinner", "Family time", "Clean up",
                "Take a bath", "Put on pajamas", "Bedtime story", "Go to bed", "Set alarm",
                "Say goodnight", "Brush hair", "Use the toilet", "Wash hands", "Drink water"
            ],
            "Emotions": [
                "Happy", "Sad", "Angry", "Excited", "Nervous",
                "Calm", "Scared", "Surprised", "Confused", "Frustrated",
                "Proud", "Embarrassed", "Lonely", "Bored", "Anxious",
                "Jealous", "Disappointed", "Grateful", "Hopeful", "Curious",
                "Relieved", "Guilty", "Ashamed", "Content", "Overwhelmed",
                "Shocked", "Amused", "Confident", "Worried", "Envious"
            ],
            "School Activities": [
                "Fire drill", "Standing in line", "No touching", "Sit", "Bathroom",
                "Recess", "Work", "Circle time", "Read", "Write",
                "Raise hand", "Listen", "Quiet", "Snack time", "Lunch",
                "Play", "Share", "Clean up", "Art class", "Music class",
                "Gym class", "Library", "School bus", "Teacher", "Personal space",
                "Time out", "Stop", "More", "Good", "Student"
            ],
            "Well-Being Questions and Communication": [
                "Pain", "Sore throat", "Head hurts", "Tired", "Constipated",
                "Anxious", "How are you feeling?", "Happy", "Sad", "Angry",
                "Hungry", "Thirsty", "Sick", "Calm", "Nervous",
                "Excited", "Scared", "Bored", "Confused", "Frustrated",
                "Comfortable", "Uncomfortable", "Safe", "Unsafe", "Help",
                "Stop", "More", "Yes", "No", "Good"
            ],
            "Medical Appointments": [
                "Appointment", "Waiting room", "Nurse", "Doctor", "Check-up",
                "Blood pressure", "Temperature", "Stethoscope", "Heartbeat", "Injection",
                "Medicine", "Pills", "Syrup", "X-ray", "MRI",
                "Blood test", "Urine test", "Bandage", "Cast", "Thermometer",
                "Pain", "Hurt", "Calm", "Breathe", "Sit still",
                "Open mouth", "Say \"ah\"", "Lie down", "Stand up", "All done"
            ],
            "People": [
                "Mom", "Dad", "Sister", "Brother", "Grandmother",
                "Grandfather", "Friend", "Teacher", "Policeman", "Doctor",
                "Occupational Therapist", "Speech Therapist", "Physical Therapist (PT)", "Priest", "Nurse",
                "Dentist", "Neighbor", "Classmate", "Principal", "Coach",
                "Babysitter", "Librarian", "Bus driver", "Mail carrier", "Firefighter",
                "Chef", "Farmer", "Mechanic", "Cashier", "Waiter/Waitress"
            ],
            "Food and Drink": [
                "Breakfast", "Lunch", "Dinner", "Snack", "Water",
                "Juice", "Milk", "Tea", "Coffee", "Fruit",
                "Vegetables", "Bread", "Cereal", "Sandwich", "Soup",
                "Salad", "Pasta", "Rice", "Meat", "Fish",
                "Chicken", "Eggs", "Cheese", "Yogurt", "Ice cream",
                "Cake", "Cookies", "Candy", "Pizza", "Hamburger"
            ],
            "Safety Signs": [
                "Stop", "Caution", "Exit", "No entry", "Danger",
                "Fire exit", "Emergency", "First aid", "No smoking", "Wet floor",
                "Do not touch", "No running", "No food or drink", "No pets", "No parking",
                "Hand wash", "Keep out", "Authorized personnel only", "High voltage", "Poison",
                "Biohazard", "Flammable", "Radiation", "Hard hat area", "Safety glasses required",
                "Ear protection required", "No cell phones", "No photography", "Slippery when wet", "Keep door closed"
            ],
            "Household Chores": [
                "Washing dishes", "Vacuuming", "Sweeping", "Mopping", "Dusting",
                "Laundry", "Folding clothes", "Ironing", "Making the bed", "Cleaning windows",
                "Taking out the trash", "Recycling", "Watering plants", "Feeding pets", "Walking the dog",
                "Setting the table", "Clearing the table", "Cooking", "Baking", "Washing the car",
                "Organizing toys", "Cleaning the bathroom", "Cleaning the kitchen", "Wiping surfaces", "Changing sheets",
                "Polishing furniture", "Cleaning the fridge", "Emptying the dishwasher", "Sweeping the porch", "Raking leaves"
            ],
            "Directions": [
                "Left", "Right", "Straight", "Turn around", "Up",
                "Down", "Forward", "Backward", "Stop", "Go",
                "Enter", "Exit", "Follow", "Wait", "Come here",
                "Go there", "Upstairs", "Downstairs", "Inside", "Outside",
                "Near", "Far", "Next to", "Across", "Through",
                "Around", "Over", "Under", "Beside", "Between"
            ],
            "Holidays and Seasons": [
                "Christmas", "Easter", "Halloween", "Thanksgiving", "New Year's Day",
                "Valentine's Day", "Independence Day", "Hanukkah", "Diwali", "St. Patrick's Day",
                "Mother's Day", "Father's Day", "Labor Day", "Memorial Day", "Veterans Day",
                "Spring", "Summer", "Fall (Autumn)", "Winter", "Rainy",
                "Snowy", "Sunny", "Cloudy", "Windy", "Hot",
                "Cold", "Warm", "Cool", "Leaves falling", "Flowers blooming"
            ],
            "Body Parts": [
                "Head", "Face", "Eyes", "Ears", "Nose",
                "Mouth", "Teeth", "Tongue", "Hair", "Neck",
                "Shoulders", "Arms", "Elbows", "Hands", "Fingers",
                "Chest", "Stomach", "Back", "Legs", "Knees",
                "Feet", "Toes", "Heart", "Lungs", "Brain",
                "Muscles", "Bones", "Skin", "Nails", "Joints"
            ],
            "Health and Hygiene": [
                "Wash hands", "Brush teeth", "Take a bath", "Use the toilet", "Comb hair",
                "Cut nails", "Blow nose", "Cough", "Sneeze", "Use tissue",
                "Wash face", "Brush hair", "Floss teeth", "Use hand sanitizer", "Drink water",
                "Eat healthy", "Exercise", "Sleep", "Take medicine", "Visit doctor",
                "Visit dentist", "Wear mask", "Check temperature", "Bandage", "Rest",
                "Clean ears", "Apply lotion", "Use sunscreen", "Change clothes", "Stay clean"
            ],
            "Weather and Nature": [
                "Sunny", "Rainy", "Cloudy", "Snowy", "Windy",
                "Stormy", "Foggy", "Hot", "Cold", "Warm",
                "Cool", "Thunder", "Lightning", "Hail", "Tornado",
                "Tree", "Flower", "Grass", "Mountain", "River",
                "Ocean", "Lake", "Forest", "Desert", "Beach",
                "Rock", "Sand", "Leaf", "Animal", "Plant"
            ],
            "Time Concepts": [
                "Morning", "Afternoon", "Evening", "Night", "Day",
                "Week", "Month", "Year", "Today", "Tomorrow",
                "Yesterday", "Calendar", "Clock", "Hour", "Minute",
                "Second", "Now", "Later", "Soon", "Before",
                "After", "Early", "Late", "On time", "Schedule",
                "Alarm", "Timer", "Bedtime", "Lunchtime", "Playtime"
            ],
            "Health Habits": [
                "Wash hands", "Brush teeth", "Take a bath", "Use the toilet", "Comb hair",
                "Cut nails", "Blow nose", "Cough", "Sneeze", "Use tissue",
                "Wash face", "Brush hair", "Floss teeth", "Use hand sanitizer", "Drink water",
                "Eat healthy", "Exercise", "Sleep", "Take medicine", "Visit doctor",
                "Visit dentist", "Wear mask", "Check temperature", "Bandage", "Rest",
                "Clean ears", "Apply lotion", "Use sunscreen", "Change clothes", "Stay clean"
            ],
            "Fun and Recreation": [
                "Play", "Game", "Toy", "Puzzle", "Drawing",
                "Painting", "Coloring", "Reading", "Watching TV", "Listening to music",
                "Dancing", "Singing", "Playing an instrument", "Sports", "Soccer",
                "Basketball", "Swimming", "Running", "Biking", "Hiking",
                "Camping", "Fishing", "Playing with pets", "Visiting the park", "Swinging",
                "Sliding", "Climbing", "Building blocks", "Playing cards", "Board games"
            ],
            "Transportation and Technology": [
                // Transportation
                "Car", "Bus", "Train", "Airplane", "Bicycle",
                "Motorcycle", "Boat", "Taxi", "Truck", "Subway",
                "Tram", "Helicopter", "Scooter", "Ferry", "Ambulance",
                // Technology
                "Computer", "Laptop", "Tablet", "Smartphone", "Television",
                "Camera", "Printer", "Keyboard", "Mouse", "Headphones",
                "Speaker", "Charger", "Remote control", "USB drive", "Smartwatch"
            ]
            // All 18 topics are fully defined with their keywords
        };

        const topicOptionsDiv = document.getElementById('topicOptions');
        const keywordOptionsDiv = document.getElementById('keywordOptions');
        const topicInput = document.getElementById('topic');
        const keywordsTextarea = document.getElementById('keywords');
        const pictogramForm = document.getElementById('pictogramForm');
        const resultsDiv = document.getElementById('results');
        const searchTermsList = document.getElementById('searchTermsList');
        const pictogramResultsDiv = document.getElementById('pictogramResults');
        const errorDiv = document.getElementById('error');
        const openInstructionsBtn = document.getElementById('openInstructionsBtn');
        const instructionsModal = document.getElementById('instructionsModal');
        const closeInstructionsBtn = document.querySelector('.close-button');
        const readAloudBtn = document.getElementById('readAloudBtn');

        // Selected Voice Variable
        let selectedVoice = null;

        // Function to Load and Select a Female US Voice
        function loadSelectedVoice() {
            const voices = window.speechSynthesis.getVoices();
            // Attempt to find a female US voice
            selectedVoice = voices.find(voice => voice.lang === 'en-US' && /female/i.test(voice.name));
            if (!selectedVoice) {
                // Fallback: Select the first US English voice
                selectedVoice = voices.find(voice => voice.lang === 'en-US');
            }
        }

        // Load voices and set the selected voice
        loadSelectedVoice();

        // Some browsers (like Chrome) load voices asynchronously
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadSelectedVoice;
        }

        // Simple Cache for Pictograms
        const pictogramCache = {};

        // Rate Limiting Variables
        let requestCount = 0;
        const maxRequests = 100; // Example limit
        const resetTime = 3600000; // 1 hour in milliseconds

        // Reset request count every hour
        setInterval(() => {
            requestCount = 0;
        }, resetTime);

        // Function to Sanitize User Inputs
        function sanitizeInput(input) {
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }

        // Generate Topic Buttons
        function generateTopicButtons() {
            for (let topic in topics) {
                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = topic;
                button.setAttribute('aria-label', `Select topic ${topic}`);
                button.addEventListener('click', function() {
                    topicInput.value = topic;
                    loadKeywords(topic);
                    // Highlight active topic
                    document.querySelectorAll('#topicOptions button').forEach(btn => btn.classList.remove('active-topic'));
                    this.classList.add('active-topic');
                });
                topicOptionsDiv.appendChild(button);
            }
        }

        // Load Keywords Based on Selected Topic
        function loadKeywords(selectedTopic) {
            keywordOptionsDiv.innerHTML = '';
            (topics[selectedTopic] || []).forEach(keyword => {
                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = keyword;
                button.setAttribute('aria-label', `Select keyword ${keyword}`);
                button.addEventListener('click', function() {
                    addKeywordToTextarea(keyword);
                    // Highlight active keyword
                    this.classList.toggle('active-keyword');
                });
                keywordOptionsDiv.appendChild(button);
            });
        }

        // Add Keyword to Textarea
        function addKeywordToTextarea(keyword) {
            let currentKeywords = keywordsTextarea.value.trim();
            const sanitizedKeyword = sanitizeInput(keyword);
            // Avoid duplicate keywords
            const keywordsArray = currentKeywords ? currentKeywords.split(',').map(k => k.trim()) : [];
            if (!keywordsArray.includes(keyword)) {
                keywordsTextarea.value = currentKeywords ? `${currentKeywords}, ${sanitizedKeyword}` : sanitizedKeyword;
            }
        }

        // Handle Form Submission
        pictogramForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const topic = topicInput.value.trim();
            const keywords = keywordsTextarea.value.trim();
            errorDiv.textContent = ''; // Clear previous errors

            if (!topic && !keywords) {
                errorDiv.textContent = 'Please enter a topic or at least one keyword.';
                return;
            } else if (!topic) {
                errorDiv.textContent = 'Please enter a topic.';
                return;
            } else if (!keywords) {
                errorDiv.textContent = 'Please enter at least one keyword.';
                return;
            }

            const searchTerms = [topic, ...keywords.split(',').map(k => k.trim())].filter(Boolean);
            const uniqueSearchTerms = [...new Set(searchTerms)];
            displayResults(uniqueSearchTerms);
            fetchPictograms(uniqueSearchTerms.slice(0, 5));
        });

        // Display Search Terms
        function displayResults(searchTerms) {
            searchTermsList.innerHTML = searchTerms.map(term => `<li>${sanitizeInput(term)}</li>`).join('');
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Fetch Pictograms from ARASAAC API
        async function fetchPictograms(searchTerms) {
            // Rate Limiting Check
            if (requestCount + searchTerms.length > maxRequests) {
                errorDiv.textContent = 'API rate limit exceeded. Please try again later.';
                return;
            }
            requestCount += searchTerms.length;

            pictogramResultsDiv.innerHTML = '';
            errorDiv.textContent = '';
            // Uncomment the following line if you have a loading spinner element
            // loadingSpinner.style.display = 'block';

            try {
                const requests = searchTerms.map(term => {
                    if (pictogramCache[term]) {
                        return Promise.resolve({ term, data: pictogramCache[term] });
                    }
                    return axios.get(`https://api.arasaac.org/api/pictograms/en/search/${encodeURIComponent(term)}`)
                        .then(response => {
                            pictogramCache[term] = response.data;
                            return { term, data: response.data };
                        })
                        .catch(error => ({ term, error }));
                });

                const results = await Promise.all(requests);

                results.forEach(result => {
                    if (result.error) {
                        errorDiv.textContent += `Error fetching pictograms for "${sanitizeInput(result.term)}". `;
                        return;
                    }

                    const pictograms = result.data.slice(0, 10); // Limit to 10 pictograms per term

                    if (pictograms.length === 0) {
                        const noResult = document.createElement('p');
                        noResult.textContent = `No pictograms found for "${sanitizeInput(result.term)}".`;
                        pictogramResultsDiv.appendChild(noResult);
                        return;
                    }

                    const section = document.createElement('section');
                    section.innerHTML = `<h4>Pictograms for "${sanitizeInput(result.term)}"</h4>`;
                    const container = document.createElement('div');
                    container.classList.add('pictogram-container');

                    pictograms.forEach(pictogram => {
                        const pictogramItem = document.createElement('div');
                        pictogramItem.classList.add('pictogram-item');

                        const link = document.createElement('a');
                        link.href = `https://static.arasaac.org/pictograms/${pictogram._id}/${pictogram._id}_500.png`;
                        link.target = '_blank';
                        link.rel = 'noopener noreferrer';

                        const img = document.createElement('img');
                        img.src = `https://static.arasaac.org/pictograms/${pictogram._id}/${pictogram._id}_300.png`;
                        img.alt = `Pictogram representing ${pictogram.keywords.map(k => k.keyword).join(', ')}`;
                        img.loading = 'lazy'; // Lazy Loading

                        link.appendChild(img);
                        pictogramItem.appendChild(link);

                        // Download Button
                        const downloadBtn = document.createElement('button');
                        downloadBtn.textContent = 'Download';
                        downloadBtn.classList.add('download-button');
                        downloadBtn.setAttribute('aria-label', `Download pictogram for ${pictogram.keywords.map(k => k.keyword).join(', ')}`);
                        downloadBtn.addEventListener('click', () => {
                            const downloadLink = document.createElement('a');
                            downloadLink.href = `https://static.arasaac.org/pictograms/${pictogram._id}/${pictogram._id}_500.png`;
                            downloadLink.download = `${pictogram.keywords.map(k => k.keyword).join('_')}.png`;
                            document.body.appendChild(downloadLink);
                            downloadLink.click();
                            document.body.removeChild(downloadLink);
                        });

                        pictogramItem.appendChild(downloadBtn);
                        container.appendChild(pictogramItem);
                    });

                    section.appendChild(container);
                    pictogramResultsDiv.appendChild(section);
                });
            } catch (error) {
                errorDiv.textContent = 'An unexpected error occurred while fetching pictograms.';
            } finally {
                // Uncomment the following line if you have a loading spinner element
                // loadingSpinner.style.display = 'none';
            }
        }

        // Open Instructions Modal
        openInstructionsBtn.addEventListener('click', function() {
            instructionsModal.style.display = 'block';
            instructionsModal.setAttribute('aria-hidden', 'false');
            // Set focus to the modal content for accessibility
            instructionsModal.querySelector('.modal-content').focus();
        });

        // Close Instructions Modal and Stop Speech
        function closeModal() {
            instructionsModal.style.display = 'none';
            instructionsModal.setAttribute('aria-hidden', 'true');
            // Stop any ongoing speech
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
        }

        // Close Instructions Modal when clicking the close button
        closeInstructionsBtn.addEventListener('click', function() {
            closeModal();
        });

        // Close modal when clicking outside of the modal content
        window.addEventListener('click', function(event) {
            if (event.target == instructionsModal) {
                closeModal();
            }
        });

        // Close modal on pressing Escape key
        window.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && instructionsModal.style.display === 'block') {
                closeModal();
            }
        });

        // Read Aloud Functionality with Female US Voice
        readAloudBtn.addEventListener('click', function() {
            const instructionsText = instructionsModal.innerText;
            if ('speechSynthesis' in window) {
                // Stop any ongoing speech before starting a new one
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }

                const utterance = new SpeechSynthesisUtterance(instructionsText);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                    utterance.lang = selectedVoice.lang;
                } else {
                    // Fallback: Use default voice if no female US voice is found
                    utterance.lang = 'en-US';
                }
                window.speechSynthesis.speak(utterance);
            } else {
                alert('Sorry, your browser does not support text-to-speech functionality.');
            }
        });

        // Generate Topic Buttons on Page Load
        generateTopicButtons();
        loadKeywords("Daily Routine"); // Load default topic

        // Highlight Active Navigation Link
        const currentPage = window.location.pathname.split('/').pop();
        document.querySelectorAll('nav a').forEach(link => {
            if (link.getAttribute('href') === currentPage) {
                link.classList.add('active');
            }
        });
    });
</script>

<!-- NoScript Message -->
<noscript>
    <p style="text-align:center; color:red; margin-top:20px;">
        JavaScript is required for full functionality of this site. Please enable JavaScript in your browser settings.
    </p>
</noscript>

</body>
</html>
